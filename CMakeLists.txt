cmake_minimum_required(VERSION 3.14)
project(project_synapse LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1ï¸âƒ£ ê¸°ë³¸ ì„¤ì •
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
message(STATUS "ğŸ”§ Configuring Project SYNAPSE")

set(PROJECT_ROOT ${CMAKE_CURRENT_SOURCE_DIR})
include_directories(${PROJECT_ROOT}/common)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2ï¸âƒ£ vsomeip3 (ë¼ì¦ˆë² ë¦¬íŒŒì´ ê¸°ì¤€)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
find_path(VSOMEIP_INCLUDE_DIR vsomeip/vsomeip.hpp
          PATHS /usr/local/include /usr/include)

find_library(VSOMEIP_LIB vsomeip3 PATHS /usr/local/lib /usr/lib)
find_library(VSOMEIP_CFG_LIB vsomeip3-cfg PATHS /usr/local/lib /usr/lib)
find_library(VSOMEIP_E2E_LIB vsomeip3-e2e PATHS /usr/local/lib /usr/lib)
find_library(VSOMEIP_SD_LIB vsomeip3-sd PATHS /usr/local/lib /usr/lib)

if(NOT VSOMEIP_LIB)
  message(FATAL_ERROR "âŒ vsomeip3 not found. Please check /usr/local/lib")
else()
  message(STATUS "âœ… Found vsomeip3 libs: ${VSOMEIP_LIB}")
endif()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3ï¸âƒ£ Boost.System (vsomeip ì¢…ì†)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
find_library(BOOST_SYSTEM_LIB boost_system PATHS /usr/lib /usr/local/lib)
if(NOT BOOST_SYSTEM_LIB)
  message(FATAL_ERROR "âŒ boost_system not found. Run: sudo apt-get install -y libboost-system-dev")
else()
  message(STATUS "âœ… Found Boost.System: ${BOOST_SYSTEM_LIB}")
endif()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4ï¸âƒ£ pybind11 (ì„ íƒ)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
find_package(pybind11 QUIET)
if(NOT pybind11_FOUND)
  message(STATUS "â„¹ï¸ pybind11 not found, checking /usr/include")
  include_directories(/usr/include)
endif()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 5ï¸âƒ£ ê³µí†µ í—¤ë”-only ë¼ì´ë¸ŒëŸ¬ë¦¬
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
add_library(common INTERFACE)
target_include_directories(common INTERFACE ${PROJECT_ROOT}/common)
target_link_libraries(common INTERFACE pthread)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 6ï¸âƒ£ í•˜ìœ„ ëª¨ë“ˆ (Server / Client / Bindings)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
add_subdirectory(server)
add_subdirectory(client)
add_subdirectory(bindings)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 7ï¸âƒ£ GUI í´ë¼ì´ì–¸íŠ¸ (Qt + vSomeIP)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
option(BUILD_GUI_CLIENT "Build Qt-based GUI Client" ON)

if(BUILD_GUI_CLIENT)
  message(STATUS "ğŸ–¥ï¸  Building Qt GUI Client")

  # Qt Widgets ì°¾ê¸°
  find_package(Qt6 REQUIRED COMPONENTS Widgets)

  add_subdirectory(gui_client)

  message(STATUS "âœ… GUI Client build enabled")
else()
  message(STATUS "ğŸš« Skipping GUI client build (BUILD_GUI_CLIENT=OFF)")
endif()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 8ï¸âƒ£ ë¹Œë“œ í›„ ì•ˆë‚´ ë©”ì‹œì§€
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
message(STATUS "")
message(STATUS "âœ… Build complete!")
message(STATUS "To use Python binding:")
message(STATUS "  export PYTHONPATH=${CMAKE_BINARY_DIR}/bindings:\$PYTHONPATH")
message(STATUS "")
